





{
  "ok": true,
  "result": {
    "message_id": 133,
    "from": {
      "id": 7463392751,
      "is_bot": true,
      "first_name": "TestCheckUpBot",
      "username": "MySecretTestCheckUpBot"
    },
    "chat": {
      "id": 820216855,
      "first_name": "\u0413\u043b\u0435\u0431",
      "last_name": "\u041a\u0443\u0437\u044c\u043c\u0438\u043d",
      "username": "kaleb_sadalmalik",
      "type": "private"
    },
    "date": 1751121752,
    "text": "111"
  }
}

{'ok': True, 'result': True, 'description': 'Webhook was deleted'}

{
  "message_id": 134,
  "from": {
    "id": 820216855,
    "is_bot": false,
    "first_name": "\u0413\u043b\u0435\u0431",
    "last_name": "\u041a\u0443\u0437\u044c\u043c\u0438\u043d",
    "username": "kaleb_sadalmalik",
    "language_code": "ru",
    "is_premium": true
  },
  "chat": {
    "id": 820216855,
    "first_name": "\u0413\u043b\u0435\u0431",
    "last_name": "\u041a\u0443\u0437\u044c\u043c\u0438\u043d",
    "username": "kaleb_sadalmalik",
    "type": "private"
  },
  "date": 1751121755,
  "text": "222"
}












































F:\PROGRAMMING\python\MediBot\.venv\Scripts\python.exe F:\PROGRAMMING\python\MediBot\App.py
send_poll:
payload:
{
  "chat_id": "820216855",
  "question": "\u0432\u043e\u043f\u0440\u043e\u0441",
  "options": "[{\"text\": \"\\u041e\\u0442\\u0432\\u0435\\u0442 1\"}, {\"text\": \"\\u041e\\u0442\\u0432\\u0435\\u0442 2\"}, {\"text\": \"\\u041e\\u0442\\u0432\\u0435\\u0442 3\"}]",
  "allows_multiple_answers": true
}
response:
{
  "ok": true,
  "result": {
    "message_id": 266,
    "from": {
      "id": 7463392751,
      "is_bot": true,
      "first_name": "TestCheckUpBot",
      "username": "MySecretTestCheckUpBot"
    },
    "chat": {
      "id": 820216855,
      "first_name": "\u0413\u043b\u0435\u0431",
      "last_name": "\u041a\u0443\u0437\u044c\u043c\u0438\u043d",
      "username": "kaleb_sadalmalik",
      "type": "private"
    },
    "date": 1752047924,
    "poll": {
      "id": "5436298775524020294",
      "question": "\u0432\u043e\u043f\u0440\u043e\u0441",
      "options": [
        {
          "text": "\u041e\u0442\u0432\u0435\u0442 1",
          "voter_count": 0
        },
        {
          "text": "\u041e\u0442\u0432\u0435\u0442 2",
          "voter_count": 0
        },
        {
          "text": "\u041e\u0442\u0432\u0435\u0442 3",
          "voter_count": 0
        }
      ],
      "total_voter_count": 0,
      "is_closed": false,
      "is_anonymous": true,
      "type": "regular",
      "allows_multiple_answers": true
    }
  }
}

{'ok': True, 'result': True, 'description': 'Webhook is already deleted'}
poll:
{
  "id": "5436298775524020294",
  "question": "\u0432\u043e\u043f\u0440\u043e\u0441",
  "options": [
    {
      "text": "\u041e\u0442\u0432\u0435\u0442 1",
      "voter_count": 0
    },
    {
      "text": "\u041e\u0442\u0432\u0435\u0442 2",
      "voter_count": 0
    },
    {
      "text": "\u041e\u0442\u0432\u0435\u0442 3",
      "voter_count": 1
    }
  ],
  "total_voter_count": 1,
  "is_closed": false,
  "is_anonymous": true,
  "type": "regular",
  "allows_multiple_answers": true,
  "message_id": 266,
  "chat": {
    "id": 820216855,
    "first_name": "\u0413\u043b\u0435\u0431",
    "last_name": "\u041a\u0443\u0437\u044c\u043c\u0438\u043d",
    "username": "kaleb_sadalmalik",
    "type": "private"
  }
}
poll:
{
  "id": "5436298775524020294",
  "question": "\u0432\u043e\u043f\u0440\u043e\u0441",
  "options": [
    {
      "text": "\u041e\u0442\u0432\u0435\u0442 1",
      "voter_count": 0
    },
    {
      "text": "\u041e\u0442\u0432\u0435\u0442 2",
      "voter_count": 0
    },
    {
      "text": "\u041e\u0442\u0432\u0435\u0442 3",
      "voter_count": 1
    }
  ],
  "total_voter_count": 1,
  "is_closed": true,
  "is_anonymous": true,
  "type": "regular",
  "allows_multiple_answers": true
}

Process finished with exit code -1












{
  "update_id": 189226152,
  "message": {
    "message_id": 1324,
    "from": {
      "id": 356775702,
      "is_bot": false,
      "first_name": "Stanislav",
      "last_name": "Koronatov",
      "language_code": "en"
    },
    "chat": {
      "id": 356775702,
      "first_name": "Stanislav",
      "last_name": "Koronatov",
      "type": "private"
    },
    "date": 1753692784,
    "text": "/start",
    "entities": [
      {
        "offset": 0,
        "length": 6,
        "type": "bot_command"
      }
    ]
  }
}

Traceback (most recent call last):
  File "/home/ec2-user/tbot/Telegram/TBot.py", line 263, in run
    self._message_handler(message, session)
  File "/home/ec2-user/tbot/ScriptedBot.py", line 67, in handle_telegram_message
    self._script.goto(session, command)
  File "/home/ec2-user/tbot/Scripting/Script.py", line 96, in goto
    self.event(context, "start", None)
  File "/home/ec2-user/tbot/Scripting/Script.py", line 103, in event
    self._call_event(context, node, event, data)
  File "/home/ec2-user/tbot/Scripting/Script.py", line 85, in _call_event
    handler(self, context, node, event, data)
  File "/home/ec2-user/tbot/ScriptedBot.py", line 142, in message_node_handler
    self.event_delay(context, step, event, handler)
  File "/home/ec2-user/tbot/ScriptedBot.py", line 109, in event_delay
    inner_handler()
  File "/home/ec2-user/tbot/ScriptedBot.py", line 136, in handler
    self._bot.send(chat_id, format_text(message, context))
  File "/home/ec2-user/tbot/Scripting/Script.py", line 9, in format_text
    name = context["chat"]["username"]
KeyError: 'username'






Если нет юзернейма - можно отправить *упоминание* в тексте
[
{
    "type": "text_mention",
    "offset": 7,
    "length": 9,
    "user": {
      "id": 123456789,
      "is_bot": false,
      "first_name": "John Doe"
    }
}
]



